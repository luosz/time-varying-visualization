vis = renderslices[facename];
visibility = 
 ParallelTable[
  ImageMeasurements[ImageMultiply[vis, features[[i]]], 
    "TotalIntensity"]/ImageMeasurements[vis, "TotalIntensity"], {i, 
   Length[features]}]
chart1 = BarChart[visibility, PlotLabel -> "Visibility", 
  ChartLegends -> legends, ChartStyle -> (chartcolors // Darker), 
  ChartLabels -> Placed[ToString /@ visibility, Above]]
dog = g1;
saliency = 
 ParallelTable[
  ImageMeasurements[ImageMultiply[dog, features[[i]]], 
    "TotalIntensity"]/ImageMeasurements[dog, "TotalIntensity"], {i, 
   Length[features]}]
chart0 = BarChart[saliency, PlotLabel -> "Saliency", 
  ChartLegends -> legends, ChartStyle -> chartcolors, 
  ChartLabels -> Placed[ToString /@ saliency, Above]]
viss = ImageMultiply[dog, vis];
vs = ParallelTable[
  ImageMeasurements[ImageMultiply[viss, features[[i]]], 
    "TotalIntensity"]/ImageMeasurements[viss, "TotalIntensity"], {i, 
   Length[features]}]
chart2 = BarChart[vs, 
  PlotLabel -> "Visibility-weighted saliency of brightness", 
  ChartLegends -> legends, ChartStyle -> (chartcolors // Lighter), 
  ChartLabels -> Placed[ToString /@ vs, Above]]
viss2 = ImageMultiply[g2, vis];
vs2 = ParallelTable[
  ImageMeasurements[ImageMultiply[viss2, features[[i]]], 
    "TotalIntensity"]/ImageMeasurements[viss2, "TotalIntensity"], {i, 
   Length[features]}]
chart2b = 
 BarChart[vs2, 
  PlotLabel -> "Visibility-weighted saliency of saturation", 
  ChartLegends -> legends, ChartStyle -> (chartcolors // Lighter), 
  ChartLabels -> Placed[ToString /@ vs2, Above]]
mean = Mean[{vs, vs2}]
weighted = 
 BarChart[mean, PlotLabel -> "Visibility-weighted saliency", 
  ChartLegends -> legends, ChartStyle -> chartcolors, 
  ChartLabels -> Placed[ToString /@ mean, Above]]
charts = {chart0, chart1, chart2, chart2b, weighted};
scores = {saliency, visibility, vs, vs2, mean};
imagefilenames2 = 
  StringReplace[#, "." -> "_" <> facename <> "."] & /@ imagefilenames;
txtfilenames2 = 
  StringReplace[#, "." -> "_" <> facename <> "."] & /@ txtfilenames;
Table[Export[imagefilenames2[[i]], charts[[i]]], {i, Length[charts]}];
(*Table[Export[txtfilenames2[[i]],scores[[i]]],{i,Length[scores]}];*)


scoremap = Association@Import[resultxml];
AssociateTo[scoremap, dataname <> "_" <> facename -> scores];
Export[resultxml, Normal[scoremap]];
w = ImageAdd[viss, viss2] // ImageAdjust;
results = ImageMultiply[w, #] & /@ features;
MapIndexed[
  Export[StringReplace[featurefilename, 
     "." -> ToString[First[#2]] <> "_" <> facename <> "."], #] &, 
  results];