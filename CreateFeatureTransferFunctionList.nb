(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     31329,        754]
NotebookOptionsPosition[     30926,        736]
NotebookOutlinePosition[     31271,        751]
CellTagsIndexPosition[     31228,        748]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"validfeatures", "=", 
   RowBox[{"StringSplit", "/@", 
    RowBox[{"StringSplit", "[", 
     RowBox[{
      RowBox[{"Import", "[", 
       RowBox[{
       "\"\<D:\\\\document\\\\work\\\\saliency-experiment\\\\documentation\\\\\
ASFdemos\\\\brm\\\\saliency\\\\random_merged_feature.txt\>\"", ",", 
        "\"\<Text\>\""}], "]"}], ",", "\"\<\\n\>\""}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lines2", "=", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"validfeatures", "[", 
      RowBox[{"[", 
       RowBox[{"2", ";;"}], "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"ToExpression", "[", 
        RowBox[{"#", "[", 
         RowBox[{"[", "11", "]"}], "]"}], "]"}], "\[NotEqual]", "0"}], 
      "&"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filenamelist", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"#", "[", 
      RowBox[{"[", "10", "]"}], "]"}], "&"}], "/@", "lines2"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"datanamelist", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"StringReplace", "[", 
       RowBox[{"#", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<img\\\\\>\"", "\[Rule]", "\"\<\>\""}], ",", 
          RowBox[{"\"\<.png\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}], "]"}], 
      "&"}], "/@", "filenamelist"}], "//", "DeleteDuplicates"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"TableForm", "[", 
  RowBox[{"datanamelist", ",", 
   RowBox[{"TableHeadings", "\[Rule]", "Automatic"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.6555600320181675`*^9, 3.6555600549715514`*^9}, {
  3.655560087432172*^9, 3.6555602348480816`*^9}, {3.655561850757766*^9, 
  3.6555618620529256`*^9}}],

Cell[BoxData[
 TagBox[
  TagBox[GridBox[{
     {"1", "\<\"CT-Knee_naive_optimized_green_1000\"\>"},
     {"2", "\<\"CT-Knee_naive\"\>"},
     {"3", "\<\"CT-Knee_strong_green\"\>"},
     {"4", "\<\"CT-Knee_strong_red\"\>"},
     {"5", "\<\"CT-Knee_weak_green_optimized_green_1000\"\>"},
     {"6", "\<\"CT-Knee_weak_green\"\>"},
     {"7", "\<\"CT-Knee_weak_red_optimized_red_1000\"\>"},
     {"8", "\<\"CT-Knee_weak_red\"\>"},
     {"9", "\<\"engine_medium_green\"\>"},
     {"10", "\<\"engine_naive_optimized_green_1000\"\>"},
     {"11", "\<\"engine_naive\"\>"},
     {"12", "\<\"engine_strong_green\"\>"},
     {"13", "\<\"engine_weak_green\"\>"},
     {"14", "\<\"engine_weak_red_optimized_red_1000\"\>"},
     {"15", "\<\"engine_weak_red\"\>"},
     {"16", "\<\"foot_green_medium_optimized_green_1000\"\>"},
     {"17", "\<\"foot_green_medium\"\>"},
     {"18", "\<\"foot_green_strong\"\>"},
     {"19", "\<\"foot_green_weak\"\>"},
     {"20", "\<\"foot_naive_optimized_green_1000\"\>"},
     {"21", "\<\"foot_naive\"\>"},
     {"22", "\<\"horse_embryo_45_days_naive2_optimized_blue_1000\"\>"},
     {"23", "\<\"horse_embryo_45_days_naive2\"\>"},
     {"24", "\<\"horse_embryo_45_days_naive_optimized_blue_1000\"\>"},
     {"25", "\<\"horse_embryo_45_days_naive\"\>"},
     {"26", "\<\"MRbrain_naive_optimized_green_1000\"\>"},
     {"27", "\<\"MRbrain_naive\"\>"},
     {"28", "\<\"MRbrain_strong_green\"\>"},
     {"29", "\<\"MRbrain_weak_green\"\>"},
     {"30", "\<\"nucleon_naive_optimized_green_1000\"\>"},
     {"31", "\<\"nucleon_naive_optimized_red_1000\"\>"},
     {"32", "\<\"nucleon_naive\"\>"},
     {"33", "\<\"nucleon_strong_red\"\>"},
     {"34", "\<\"nucleon_weak_red\"\>"},
     {"35", "\<\"tooth_naive_optimized_yellow_1000\"\>"},
     {"36", "\<\"tooth_naive\"\>"},
     {"37", "\<\"tooth_strong_yellow\"\>"},
     {"38", "\<\"tooth_weak_yellow_optimized_yellow_1000\"\>"},
     {"39", "\<\"tooth_weak_yellow\"\>"},
     {"40", "\<\"vismale_naive_optimized_green_1000\"\>"},
     {"41", "\<\"vismale_naive_optimized_red_1000\"\>"},
     {"42", "\<\"vismale_naive\"\>"},
     {"43", "\<\"vismale_strong_green\"\>"},
     {"44", "\<\"vismale_strong_red\"\>"},
     {"45", "\<\"vismale_weak_red\"\>"},
     {"46", "\<\"vismale_week_green\"\>"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxDividers->{
     "Columns" -> {False, {True}, False}, "ColumnsIndexed" -> {}, 
      "Rows" -> {{False}}, "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.5599999999999999]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}],
   OutputFormsDump`HeadedColumn],
  Function[BoxForm`e$, 
   TableForm[BoxForm`e$, TableHeadings -> Automatic]]]], "Output",
 CellChangeTimes->{{3.6555601573786817`*^9, 3.655560259586378*^9}, 
   3.655561768360444*^9, {3.655561863523467*^9, 3.6555618797381487`*^9}, 
   3.655561917054961*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"pathlist", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "xml", ",", "tfifile", ",", "volumefile", ",", "legends", ",", "face",
          ",", "imagefilenames", ",", "txtfilenames", ",", "featurefilename", 
         ",", "visibilityfilename", ",", "resultxml", ",", "imagefile", ",", 
         "rawfile", ",", "dataname", ",", "tf", ",", "bincount", ",", 
         "intensity", ",", "r", ",", "g", ",", "b", ",", "a", ",", 
         "rgbcolors", ",", "rgbfunction", ",", "rgba", ",", "rgbafunction", 
         ",", "alpha", ",", "intensity0", ",", "alpha0", ",", "d", ",", 
         "colorized", ",", "pos", ",", "index", ",", "chartcolors", ",", 
         "viewpoints", ",", "rangeOfAlpha", ",", "plotpath", ",", "imagepath",
          ",", "tfpath", ",", "tflist"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xml", "=", 
         RowBox[{"Import", "[", 
          RowBox[{
           RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
           "\"\<~images\\\\\>\"", "<>", "xmlstr", "<>", "\"\<.xml\>\""}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "tfifile", ",", "volumefile", ",", "legends", ",", "face", ",", 
           "imagefilenames", ",", "txtfilenames", ",", 
           RowBox[{"{", 
            RowBox[{"featurefilename", ",", "visibilityfilename"}], "}"}], 
           ",", "resultxml", ",", "imagefile", ",", "rawfile", ",", 
           "dataname", ",", "plotpath", ",", "imagepath"}], "}"}], "=", 
         "xml"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tf", "=", 
         RowBox[{"Import", "[", 
          RowBox[{"tfifile", ",", "\"\<XML\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"bincount", "=", "256"}], ";", "\[IndentingNewLine]", 
        RowBox[{"intensity", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"tf", ",", 
            RowBox[{
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<intensity\>\"", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<value\>\"", "\[Rule]", "atrib_"}], ",", "___"}],
                 "}"}], ",", "___"}], "]"}], "\[RuleDelayed]", "atrib"}], ",",
             "\[Infinity]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"r", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"tf", ",", 
            RowBox[{
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<colorL\>\"", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<r\>\"", "\[Rule]", "atrib_"}], ",", "___"}], 
                "}"}], ",", "___"}], "]"}], "\[RuleDelayed]", "atrib"}], ",", 
            "\[Infinity]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"g", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"tf", ",", 
            RowBox[{
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<colorL\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"___", ",", 
                 RowBox[{"\"\<g\>\"", "\[Rule]", "atrib_"}], ",", "___"}], 
                "}"}], ",", "___"}], "]"}], "\[RuleDelayed]", "atrib"}], ",", 
            "\[Infinity]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"b", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"tf", ",", 
            RowBox[{
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<colorL\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"___", ",", 
                 RowBox[{"\"\<b\>\"", "\[Rule]", "atrib_"}], ",", "___"}], 
                "}"}], ",", "___"}], "]"}], "\[RuleDelayed]", "atrib"}], ",", 
            "\[Infinity]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"a", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"tf", ",", 
            RowBox[{
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<colorL\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"___", ",", 
                 RowBox[{"\"\<a\>\"", "\[Rule]", "atrib_"}]}], "}"}], ",", 
               "___"}], "]"}], "\[RuleDelayed]", "atrib"}], ",", 
            "\[Infinity]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"rgbcolors", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "/", "255."}], "&"}], ")"}], "/@", 
           RowBox[{"Transpose", "[", 
            RowBox[{"{", 
             RowBox[{"r", ",", "g", ",", "b"}], "}"}], "]"}]}], "//", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"RGBColor", "/@", "#"}], "&"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rgbfunction", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Blend", "[", 
            RowBox[{
             RowBox[{"Transpose", "[", 
              RowBox[{"{", 
               RowBox[{"intensity", ",", "rgbcolors"}], "}"}], "]"}], ",", 
             " ", "#1"}], "]"}], " ", "&"}], " ", ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rgba", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "/", "255."}], "&"}], ")"}], "/@", 
           RowBox[{"Transpose", "[", 
            RowBox[{"{", 
             RowBox[{"r", ",", "g", ",", "b", ",", "a"}], "}"}], "]"}]}], "//", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"RGBColor", "/@", "#"}], "&"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rgbafunction", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Blend", "[", 
            RowBox[{
             RowBox[{"Transpose", "[", 
              RowBox[{"{", 
               RowBox[{"intensity", ",", "rgba"}], "}"}], "]"}], ",", " ", 
             "#1"}], "]"}], " ", "&"}], " ", ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"alpha", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "/", "255."}], "&"}], ")"}], "/@", "a"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"d", " ", "=", " ", 
         RowBox[{"Import", "[", 
          RowBox[{"volumefile", ",", "\"\<Image3D\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pos", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"intensity", "[", 
            RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{"alpha", ",", 
             RowBox[{"_", "?", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#", "==", "0"}], "&"}], ")"}]}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"index", "=", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Position", "[", 
           RowBox[{"alpha", ",", 
            RowBox[{"_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"chartcolors", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"rgbcolors", "[", 
            RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "index"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"viewpoints", "=", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<top\>\"", "\[RuleDelayed]", "Top"}], ",", 
           RowBox[{"\"\<back\>\"", "\[RuleDelayed]", "Back"}], ",", 
           RowBox[{"\"\<left\>\"", "\[RuleDelayed]", "Left"}], ",", 
           RowBox[{"\"\<bottom\>\"", "\[RuleDelayed]", "Bottom"}], ",", 
           RowBox[{"\"\<front\>\"", "\[RuleDelayed]", "Front"}], ",", 
           RowBox[{"\"\<right\>\"", "\[RuleDelayed]", "Right"}]}], "|>"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"intensity0", "=", "intensity"}], ";", "\[IndentingNewLine]", 
        RowBox[{"alpha0", "=", "alpha"}], ";", "\[IndentingNewLine]", 
        RowBox[{"rangeOfAlpha", "=", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "alpha", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"First", "[", "intensity0", "]"}], ">", "0"}], ",", 
          RowBox[{
           RowBox[{"intensity0", "=", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", "0", "}"}], ",", "intensity0"}], "]"}]}], ";", 
           RowBox[{"alpha0", "=", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", "0", "}"}], ",", "alpha0"}], "]"}]}], ";", 
           RowBox[{"rangeOfAlpha", "+=", "1"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Last", "[", "intensity0", "]"}], "<", "1"}], ",", 
          RowBox[{
           RowBox[{"intensity0", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"intensity0", ",", 
              RowBox[{"{", "1", "}"}]}], "]"}]}], ";", 
           RowBox[{"alpha0", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"alpha0", ",", 
              RowBox[{"{", "0", "}"}]}], "]"}]}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"index0", "=", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Position", "[", 
           RowBox[{"alpha0", ",", 
            RowBox[{"_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"saveTransferFunction", "[", 
          RowBox[{"peaks_", ",", "filename_"}], "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "a2", ",", "rgba2", ",", "intensity2", ",", "rgbafunction2", ",", 
             "rgba2denormalized", ",", "xrgba", ",", "strlist", ",", 
             "alphaMode", ",", "gammaValue", ",", "domain", ",", "threshold", 
             ",", "k", ",", "int", ",", "split", ",", "colorL", ",", 
             "keylist", ",", "keys", ",", "TransFuncIntensity", ",", 
             "VoreenData", ",", "xmlobject"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"MapIndexed", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"alpha0", "[", 
                  RowBox[{"[", "#", "]"}], "]"}], "=", 
                 RowBox[{"peaks", "[", 
                  RowBox[{"[", 
                   RowBox[{"First", "@", "#2"}], "]"}], "]"}]}], ")"}], "&"}],
               ",", "index0"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"a2", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"IntegerPart", "[", 
                RowBox[{"255", "*", 
                 RowBox[{"alpha0", "[", 
                  RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
              "rangeOfAlpha"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"rgba2", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", "/", "255."}], "&"}], ")"}], "/@", 
               RowBox[{"Transpose", "[", 
                RowBox[{"{", 
                 RowBox[{"r", ",", "g", ",", "b", ",", "a2"}], "}"}], "]"}]}],
               "//", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"RGBColor", "/@", "#"}], "&"}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"intensity2", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"intensity0", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
              "rangeOfAlpha"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"rgbafunction2", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Blend", "[", 
                RowBox[{
                 RowBox[{"Transpose", "[", 
                  RowBox[{"{", 
                   RowBox[{"intensity2", ",", "rgba2"}], "}"}], "]"}], ",", 
                 " ", "#"}], "]"}], " ", "&"}], " ", ")"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{"for", " ", "return", " ", 
              RowBox[{"only", ".", " ", "not"}], " ", "used", " ", "in", " ", 
              "this", " ", "function"}], " ", "*)"}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"rgba2denormalized", "=", 
             RowBox[{"Transpose", "[", 
              RowBox[{"{", 
               RowBox[{"r", ",", "g", ",", "b", ",", "a2"}], "}"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"xrgba", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"intensity2", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "}"}], ",", 
                 RowBox[{"rgba2denormalized", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "[", "intensity2", "]"}]}], "}"}]}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"strlist", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"ToString", "[", "#1", "]"}], ",", 
                 RowBox[{"ToString", "[", "#2", "]"}], ",", 
                 RowBox[{"ToString", "[", "#3", "]"}], ",", 
                 RowBox[{"ToString", "[", "#4", "]"}], ",", 
                 RowBox[{"ToString", "[", "#5", "]"}]}], "}"}], "&"}], "@@@", 
              "xrgba"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"alphaMode", "=", 
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<alphaMode\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"\"\<value\>\"", "\[Rule]", "\"\<1\>\""}], "}"}], ",", 
               RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"gammaValue", "=", 
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<gammaValue\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"\"\<value\>\"", "\[Rule]", "\"\<1\>\""}], "}"}], ",", 
               RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"domain", "=", 
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<domain\>\"", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<x\>\"", "\[Rule]", "\"\<0\>\""}], ",", 
                 RowBox[{"\"\<y\>\"", "\[Rule]", "\"\<1\>\""}]}], "}"}], ",", 
               RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"threshold", "=", 
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<threshold\>\"", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<x\>\"", "\[Rule]", "\"\<0\>\""}], ",", 
                 RowBox[{"\"\<y\>\"", "\[Rule]", "\"\<1\>\""}]}], "}"}], ",", 
               RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"k", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"int", "=", 
                   RowBox[{"XMLElement", "[", 
                    RowBox[{"\"\<intensity\>\"", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<value\>\"", "\[Rule]", "#1"}], "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], ",", 
                  RowBox[{"split", "=", 
                   RowBox[{"XMLElement", "[", 
                    RowBox[{"\"\<split\>\"", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<value\>\"", "\[Rule]", "\"\<false\>\""}], 
                    "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], ",", 
                  RowBox[{"colorL", "=", 
                   RowBox[{"XMLElement", "[", 
                    RowBox[{"\"\<colorL\>\"", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\"\<r\>\"", "\[Rule]", "#2"}], ",", 
                    RowBox[{"\"\<g\>\"", "\[Rule]", "#3"}], ",", 
                    RowBox[{"\"\<b\>\"", "\[Rule]", "#4"}], ",", 
                    RowBox[{"\"\<a\>\"", "\[Rule]", "#5"}]}], "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}]}], "}"}], "&"}], ")"}], "@@@",
               "strlist"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"keylist", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"XMLElement", "[", 
                RowBox[{"\"\<key\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<type\>\"", "\[Rule]", "\"\<TransFuncMappingKey\>\""}], 
                  "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"#1", ",", "#2", ",", "#3"}], "}"}]}], "]"}], "&"}],
               "@@@", "k"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"keys", "=", 
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<Keys\>\"", ",", 
               RowBox[{"{", "}"}], ",", "keylist"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"TransFuncIntensity", "=", 
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<TransFuncIntensity\>\"", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<type\>\"", "\[Rule]", "\"\<TransFuncIntensity\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                "alphaMode", ",", "gammaValue", ",", "domain", ",", 
                 "threshold", ",", "keys"}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"VoreenData", "=", 
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<VoreenData\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"\"\<version\>\"", "\[Rule]", "\"\<1\>\""}], "}"}], 
               ",", 
               RowBox[{"{", "TransFuncIntensity", "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"xmlobject", "=", 
             RowBox[{
              RowBox[{"XMLObject", "[", "\"\<Document\>\"", "]"}], "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"XMLObject", "[", "\"\<Declaration\>\"", "]"}], "[", 
                  RowBox[{"\"\<Version\>\"", "\[Rule]", "\"\<1.0\>\""}], 
                  "]"}], ",", 
                 RowBox[{
                  RowBox[{"XMLObject", "[", "\"\<Comment\>\"", "]"}], "[", 
                  "\"\<This is a Voreen transfer function exported from \
Mathematica\>\"", "]"}]}], "}"}], ",", "VoreenData", ",", 
               RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Export", "[", 
             RowBox[{"filename", ",", "xmlobject", ",", " ", "\"\<XML\>\""}], 
             "]"}], ";", "\[IndentingNewLine]", "rgbafunction2"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"peaks", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"alpha", "[", 
            RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "index"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tfpath", "=", 
         RowBox[{
          RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
          "\"\<~salience\\\\\>\"", "<>", "dataname", "<>", "\"\<.tfi\>\""}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"saveTransferFunction", "[", 
         RowBox[{"peaks", ",", "tfpath"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tflist", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"p", ",", "tfpath2"}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"p", "=", 
               RowBox[{"ConstantArray", "[", 
                RowBox[{"0", ",", 
                 RowBox[{"Length", "[", "peaks", "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "=", 
               RowBox[{"peaks", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"tfpath2", "=", 
               RowBox[{"StringReplace", "[", 
                RowBox[{"tfpath", ",", 
                 RowBox[{"\"\<.tfi\>\"", "->", 
                  RowBox[{"\"\<_\>\"", "<>", 
                   RowBox[{"ToString", "[", "i", "]"}], "<>", 
                   "\"\<.tfi\>\""}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"saveTransferFunction", "[", 
               RowBox[{"p", ",", "tfpath2"}], "]"}], ";", 
              "\[IndentingNewLine]", "tfpath2"}]}], "\[IndentingNewLine]", 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "peaks", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"tfpath", ",", "tflist"}], "}"}]}]}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"Image3D", "[", 
          RowBox[{"d", ",", 
           RowBox[{"ColorFunction", "\[Rule]", "#"}], ",", 
           RowBox[{"ViewPoint", "\[Rule]", 
            RowBox[{"viewpoints", "[", "face", "]"}]}]}], "]"}], "&"}], "/@", 
        "tflist"}], "*)"}], "\[IndentingNewLine]", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"xmlstr", ",", "datanamelist"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.655554082405849*^9, 3.655554126774208*^9}, {
   3.6555541605030904`*^9, 3.6555541620885396`*^9}, {3.655554260736865*^9, 
   3.655554300381*^9}, {3.655554512345025*^9, 3.655554536777725*^9}, 
   3.6555547024060297`*^9, {3.6555558736390495`*^9, 3.6555559028725867`*^9}, {
   3.655556193132907*^9, 3.655556244724927*^9}, {3.655556286109581*^9, 
   3.6555563666323977`*^9}, {3.6555566984023867`*^9, 3.655556773811528*^9}, {
   3.6555574772321234`*^9, 3.655557483279252*^9}, {3.655558776668374*^9, 
   3.655558792740161*^9}, {3.6555589711947913`*^9, 3.655559109692063*^9}, {
   3.655559357411625*^9, 3.6555593585879045`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"names", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<CT-Knee\>\"", ",", "\"\<engine\>\"", ",", "\"\<foot\>\"", ",", 
     "\"\<horse_embryo_45_days\>\"", ",", "\"\<MRbrain\>\"", ",", 
     "\"\<nucleon\>\"", ",", "\"\<tooth\>\"", ",", "\"\<vismale\>\""}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"flat", "=", 
   RowBox[{"Flatten", "[", "pathlist", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"flat", ",", 
       RowBox[{
        RowBox[{"StringContainsQ", "[", 
         RowBox[{"#", ",", "i"}], "]"}], "&"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "names"}], "}"}]}], "]"}], "//", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<tfilist.txt\>\""}],
       ",", "#"}], "]"}], "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"StringReplace", "[", 
        RowBox[{
         RowBox[{"First", "@", "l"}], ",", 
         RowBox[{"\"\<.tfi\>\"", "\[Rule]", "\"\<.png\>\""}]}], "]"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"StringReplace", "[", 
          RowBox[{"#", ",", 
           RowBox[{"\"\<.tfi\>\"", "\[Rule]", "\"\<.png\>\""}]}], "]"}], 
         "&"}], "/@", 
        RowBox[{"Last", "@", "l"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"l", ",", "pathlist"}], "}"}]}], "]"}], "//", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<pnglist.xml\>\""}],
       ",", "#"}], "]"}], "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"TableForm", "[", 
    RowBox[{"flat", ",", 
     RowBox[{"TableHeadings", "\[Rule]", "Automatic"}]}], "]"}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.6555575509765415`*^9, 3.6555575566535187`*^9}, {
  3.6555576471672697`*^9, 3.655557714057126*^9}, {3.6555577503153925`*^9, 
  3.6555578647495084`*^9}, {3.6555579701470137`*^9, 3.655558085739484*^9}, {
  3.6555588064078894`*^9, 3.655558864974907*^9}, {3.6555591263537292`*^9, 
  3.6555591315918527`*^9}, {3.655559185172614*^9, 3.6555591940986447`*^9}, {
  3.655559410172371*^9, 3.655559468482501*^9}, {3.6555598528697414`*^9, 
  3.655559872949812*^9}}]
},
WindowSize->{1282, 797},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
FrontEndVersion->"10.3 for Microsoft Windows (64-bit) (October 9, 2015)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 1760, 50, 152, "Input"],
Cell[2343, 74, 3116, 68, 716, "Output"]
}, Open  ]],
Cell[5474, 145, 23005, 521, 1492, "Input"],
Cell[28482, 668, 2440, 66, 132, "Input"]
}
]
*)

(* End of internal cache information *)
