(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     33443,        859]
NotebookOptionsPosition[     32414,        824]
NotebookOutlinePosition[     32759,        839]
CellTagsIndexPosition[     32716,        836]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"ImageListAdd", "[", "imgs_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "r", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"r", "=", 
      RowBox[{"First", "@", "imgs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"r", "=", 
        RowBox[{"ImageAdd", "[", 
         RowBox[{"r", ",", "i"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"imgs", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "r"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ImageListMultiply", "[", "imgs_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "r", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"r", "=", 
      RowBox[{"First", "@", "imgs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"r", "=", 
        RowBox[{"ImageMultiply", "[", 
         RowBox[{"r", ",", "i"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"imgs", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "r"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ImageListSubtract", "[", 
   RowBox[{"img_", ",", "imgs_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "r", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"r", "=", "img"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"r", "=", 
        RowBox[{"ImageSubtract", "[", 
         RowBox[{"r", ",", "i"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "imgs"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "r"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.655494572586294*^9, 3.6554946999792457`*^9}, {
  3.6554947543806624`*^9, 3.6554947970141325`*^9}, {3.655494983731018*^9, 
  3.6554949841070366`*^9}, {3.6554955386427326`*^9, 3.655495637252885*^9}, {
  3.655495747559981*^9, 3.6554957997377453`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"inpath", "=", 
   RowBox[{
    RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
    "\"\<~salience\\\\\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"outpath", "=", 
   RowBox[{
    RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
    "\"\<~saliencemap\\\\\>\""}]}], ";"}]}], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vortslist", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Import", "[", 
      RowBox[{"inpath", "<>", "\"\<vortslist1.xml\>\""}], "]"}], ",", 
     RowBox[{"Import", "[", 
      RowBox[{"inpath", "<>", "\"\<vortslist2.xml\>\""}], "]"}], ",", 
     RowBox[{"Import", "[", 
      RowBox[{"inpath", "<>", "\"\<vortslist3.xml\>\""}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pnglist", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"inpath", "<>", "\"\<vortslist1.xml\>\""}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.6571365451260695`*^9, 3.6571366625935497`*^9}, {
  3.65713672362463*^9, 3.6571367451942177`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"t1", "=", 
   RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"results", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pngname", ",", "xmlname", ",", "mixed", ",", "imglist", ",", "xml", 
         ",", "tfifile", ",", "volumefile", ",", "legends", ",", "face", ",", 
         "imagefilenames", ",", "txtfilenames", ",", "featurefilename", ",", 
         "visibilityfilename", ",", "resultxml", ",", "imagefile", ",", 
         "rawfile", ",", "dataname", ",", "plotpath", ",", "imagepath", ",", 
         "tf", ",", "bincount", ",", "intensity", ",", "r", ",", "g", ",", 
         "b", ",", "a", ",", "rgbcolors", ",", "alpha", ",", "index", ",", 
         "chartcolors", ",", "dist", ",", "n", ",", "sets", ",", "subsets", 
         ",", "denominator", ",", "weights", ",", "saliency", ",", "overlap", 
         ",", "size", ",", "left", ",", "gaussian", ",", "sumOfGaussian", ",",
          "ratio", ",", "leftGaussian", ",", "weightedSaliency", ",", 
         "features2", ",", "total2", ",", "metric", ",", "chart", ",", 
         "saliencemap", ",", "saliencemapxml", ",", "saliencemap2", ",", 
         "saliencemapxml2", ",", "chart2"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"index", "=", "36"}], ";"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pngname", "=", 
         RowBox[{"First", "@", "pngstr"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"xmlname", "=", 
         RowBox[{"StringReplace", "[", 
          RowBox[{
           RowBox[{"Last", "@", 
            RowBox[{"StringSplit", "[", 
             RowBox[{"pngname", ",", "\"\<\\\\\>\""}], "]"}]}], ",", 
           RowBox[{"\"\<.png\>\"", "\[Rule]", "\"\<.xml\>\""}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"mixed", "=", 
         RowBox[{"Import", "[", "pngname", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"imglist", "=", 
         RowBox[{"Import", "/@", 
          RowBox[{"Last", "@", "pngstr"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"{", 
          RowBox[{"mixed", ",", "imglist"}], "}"}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"xml", "=", 
         RowBox[{"Import", "[", 
          RowBox[{
           RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
           "\"\<~images\\\\\>\"", "<>", "xmlname"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "tfifile", ",", "volumefile", ",", "legends", ",", "face", ",", 
           "imagefilenames", ",", "txtfilenames", ",", 
           RowBox[{"{", 
            RowBox[{"featurefilename", ",", "visibilityfilename"}], "}"}], 
           ",", "resultxml", ",", "imagefile", ",", "rawfile", ",", 
           "dataname", ",", "plotpath", ",", "imagepath"}], "}"}], "=", 
         "xml"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tf", "=", 
         RowBox[{"Import", "[", 
          RowBox[{"tfifile", ",", "\"\<XML\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"bincount", "=", "256"}], ";", "\[IndentingNewLine]", 
        RowBox[{"intensity", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"tf", ",", 
            RowBox[{
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<intensity\>\"", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<value\>\"", "\[Rule]", "atrib_"}], ",", "___"}],
                 "}"}], ",", "___"}], "]"}], "\[RuleDelayed]", "atrib"}], ",",
             "\[Infinity]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"r", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"tf", ",", 
            RowBox[{
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<colorL\>\"", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<r\>\"", "\[Rule]", "atrib_"}], ",", "___"}], 
                "}"}], ",", "___"}], "]"}], "\[RuleDelayed]", "atrib"}], ",", 
            "\[Infinity]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"g", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"tf", ",", 
            RowBox[{
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<colorL\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"___", ",", 
                 RowBox[{"\"\<g\>\"", "\[Rule]", "atrib_"}], ",", "___"}], 
                "}"}], ",", "___"}], "]"}], "\[RuleDelayed]", "atrib"}], ",", 
            "\[Infinity]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"b", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"tf", ",", 
            RowBox[{
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<colorL\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"___", ",", 
                 RowBox[{"\"\<b\>\"", "\[Rule]", "atrib_"}], ",", "___"}], 
                "}"}], ",", "___"}], "]"}], "\[RuleDelayed]", "atrib"}], ",", 
            "\[Infinity]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"a", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"tf", ",", 
            RowBox[{
             RowBox[{"XMLElement", "[", 
              RowBox[{"\"\<colorL\>\"", ",", 
               RowBox[{"{", 
                RowBox[{"___", ",", 
                 RowBox[{"\"\<a\>\"", "\[Rule]", "atrib_"}]}], "}"}], ",", 
               "___"}], "]"}], "\[RuleDelayed]", "atrib"}], ",", 
            "\[Infinity]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"rgbcolors", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "/", "255."}], "&"}], ")"}], "/@", 
           RowBox[{"Transpose", "[", 
            RowBox[{"{", 
             RowBox[{"r", ",", "g", ",", "b"}], "}"}], "]"}]}], "//", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"RGBColor", "/@", "#"}], "&"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"alpha", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "/", "255."}], "&"}], ")"}], "/@", "a"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"index", "=", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Position", "[", 
           RowBox[{"alpha", ",", 
            RowBox[{"_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"chartcolors", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"rgbcolors", "[", 
            RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "index"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"dist", "=", 
         RowBox[{"ParallelMap", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ColorDistance", "[", 
             RowBox[{"#", ",", "mixed"}], "]"}], "&"}], ",", "imglist"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "imglist", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sets", "=", 
         RowBox[{"Reverse", "@", 
          RowBox[{"Subsets", "[", 
           RowBox[{
            RowBox[{"Range", "[", "n", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", "-", "1"}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"subsets", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"ImageListMultiply", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"dist", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "s"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"s", ",", "sets"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"denominator", "=", 
         RowBox[{"ImageListAdd", "[", "subsets", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"weights", "=", 
         RowBox[{"ParallelMap", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ImageApply", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"#2", "\[NotEqual]", "0"}], ",", 
                 RowBox[{"#1", "/", "#2"}], ",", "0"}], "]"}], "&"}], ",", 
              RowBox[{"{", 
               RowBox[{"#", ",", "denominator"}], "}"}]}], "]"}], "&"}], ",", 
           "subsets"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"saliency", "=", 
         RowBox[{"ImageSaliencyFilter", "[", "mixed", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"overlap", "=", 
         RowBox[{"ParallelMap", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ImageMultiply", "[", 
             RowBox[{"saliency", ",", "#"}], "]"}], "&"}], ",", "weights"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{"ImageMeasurements", "[", 
            RowBox[{"saliency", ",", "\"\<TotalIntensity\>\""}], "]"}], 
           "\[IndentingNewLine]", "features"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ImageMeasurements", "[", 
              RowBox[{"#", ",", "\"\<TotalIntensity\>\""}], "]"}], "&"}], "/@",
             "overlap"}], "\[IndentingNewLine]", 
           RowBox[{"Total", "[", "features", "]"}], "\[IndentingNewLine]", 
           RowBox[{"features", "/", 
            RowBox[{"Total", "[", "features", "]"}]}]}]}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "use", " ", "Gaussian", " ", "kernel", " ", "to", " ", "smooth", " ",
           "the", " ", "overlap", " ", "feature", " ", "saliency", " ", 
          "maps"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"size", "=", 
         RowBox[{
          RowBox[{"First", "@", 
           RowBox[{"ImageDimensions", "[", "mixed", "]"}]}], "/", "4"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"left", "=", 
         RowBox[{"ImageListSubtract", "[", 
          RowBox[{"saliency", ",", "overlap"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"gaussian", "=", 
         RowBox[{"ParallelMap", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"GaussianFilter", "[", 
             RowBox[{"#", ",", "size"}], "]"}], "&"}], ",", "overlap"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"ImageAdjust", "/@", "gaussian"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"sumOfGaussian", "=", 
         RowBox[{"ImageListAdd", "[", "gaussian", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ratio", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"ImageApply", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"#2", "\[NotEqual]", "0"}], ",", 
                RowBox[{"Clip", "[", 
                 RowBox[{"#1", "/", "#2"}], "]"}], ",", "0"}], "]"}], "&"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "sumOfGaussian"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "gaussian"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"leftGaussian", "=", 
         RowBox[{"ParallelMap", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ImageMultiply", "[", 
             RowBox[{"left", ",", "#"}], "]"}], "&"}], ",", "ratio"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"weightedSaliency", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"ImageAdd", "[", 
            RowBox[{
             RowBox[{"overlap", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"leftGaussian", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "overlap", "]"}]}], "}"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"ImageMeasurements", "[", 
          RowBox[{"saliency", ",", "\"\<TotalIntensity\>\""}], "]"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"features2", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"ImageMeasurements", "[", 
            RowBox[{"#", ",", "\"\<TotalIntensity\>\""}], "]"}], "&"}], "/@", 
          "weightedSaliency"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"total2", "=", 
         RowBox[{"Total", "[", "features2", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"metric", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"total2", "\[NotEqual]", "0"}], ",", 
           RowBox[{"features2", "/", "total2"}], ",", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", "n"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{
          "outpath", "<>", "dataname", "<>", "\"\<_saliencemap.png\>\""}], 
          ",", 
          RowBox[{"ImageMultiply", "[", 
           RowBox[{"saliency", ",", "2"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"MapIndexed", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Export", "[", 
            RowBox[{
             RowBox[{
             "outpath", "<>", "dataname", "<>", "\"\<_saliencemap_\>\"", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{"First", "@", "#2"}], "]"}], "<>", "\"\<.png\>\""}], 
             ",", 
             RowBox[{"ImageMultiply", "[", 
              RowBox[{"#", ",", "2"}], "]"}]}], "]"}], "&"}], ",", 
          "weightedSaliency"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"legends", "=", 
         RowBox[{"{", 
          RowBox[{
          "\"\<Feature 1\>\"", ",", "\"\<Feature 2\>\"", ",", 
           "\"\<Feature 3\>\"", ",", "\"\<Feature 4\>\""}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"chart", "=", 
         RowBox[{"BarChart", "[", 
          RowBox[{"metric", ",", 
           RowBox[{"PlotLabel", "\[Rule]", "\"\<2D feature saliency\>\""}], 
           ",", 
           RowBox[{"ChartLegends", "\[Rule]", "legends"}], ",", 
           RowBox[{"ChartLabels", "\[Rule]", 
            RowBox[{"Placed", "[", 
             RowBox[{
              RowBox[{"ToString", "/@", "metric"}], ",", "Above"}], "]"}]}], 
           ",", 
           RowBox[{"ChartStyle", "\[Rule]", "chartcolors"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{
          "outpath", "<>", "dataname", "<>", "\"\<_salience_chart.png\>\""}], 
          ",", "chart"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"chart2", "=", 
         RowBox[{"BarChart", "[", 
          RowBox[{"features2", ",", 
           RowBox[{
           "PlotLabel", "\[Rule]", 
            "\"\<Unnormalized 2D feature saliency\>\""}], ",", 
           RowBox[{"ChartLegends", "\[Rule]", "legends"}], ",", 
           RowBox[{"ChartLabels", "\[Rule]", 
            RowBox[{"Placed", "[", 
             RowBox[{
              RowBox[{"ToString", "/@", "features2"}], ",", "Above"}], 
             "]"}]}], ",", 
           RowBox[{"ChartStyle", "\[Rule]", "chartcolors"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
           "\"\<~metric\\\\\>\"", "<>", "dataname", "<>", 
           "\"\<_salience_chart.png\>\""}], ",", "chart2"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"saliencemapxml", "=", 
         RowBox[{"outpath", "<>", "\"\<saliencemap.xml\>\""}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"saliencemap", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"FileExistsQ", "[", "saliencemapxml", "]"}], ",", 
           RowBox[{"Association", "@", 
            RowBox[{"Import", "[", "saliencemapxml", "]"}]}], ",", 
           RowBox[{"<|", "|>"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AssociateTo", "[", 
         RowBox[{"saliencemap", ",", 
          RowBox[{"dataname", "\[Rule]", "metric"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{"saliencemapxml", ",", 
          RowBox[{"Normal", "[", "saliencemap", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"saliencemapxml2", "=", 
         RowBox[{
          RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
          "\"\<~metric\\\\unnormalized_salience.xml\>\""}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"saliencemap2", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"FileExistsQ", "[", "saliencemapxml2", "]"}], ",", 
           RowBox[{"Association", "@", 
            RowBox[{"Import", "[", "saliencemapxml2", "]"}]}], ",", 
           RowBox[{"<|", "|>"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AssociateTo", "[", 
         RowBox[{"saliencemap2", ",", 
          RowBox[{"dataname", "\[Rule]", "features2"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{"saliencemapxml2", ",", 
          RowBox[{"Normal", "[", "saliencemap2", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"dataname", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"metric", ",", "features2"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dataname", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"metric", ",", "features2"}], "}"}]}]}]}], 
      "\[IndentingNewLine]", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"pngstr", ",", "vortslist"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t2", "=", 
   RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"t2", "-", "t1"}], "\[IndentingNewLine]", 
 RowBox[{"TableForm", "[", 
  RowBox[{"results", ",", 
   RowBox[{"TableHeadings", "\[Rule]", "Automatic"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.65556102315628*^9, 3.6555610789846087`*^9}, {
   3.6555611263929625`*^9, 3.6555611344094467`*^9}, {3.6555612070110636`*^9, 
   3.6555612971603417`*^9}, {3.655561335437908*^9, 3.655561403016224*^9}, {
   3.65556144519378*^9, 3.6555614816105995`*^9}, {3.655561539180217*^9, 
   3.6555615617642756`*^9}, {3.6555617285223703`*^9, 
   3.6555617501243343`*^9}, {3.655561933879752*^9, 3.6555619340313406`*^9}, 
   3.6555666574219904`*^9, 3.6555672391358604`*^9, {3.6555678290111237`*^9, 
   3.6555678349466023`*^9}, {3.655567867156578*^9, 3.655567899797312*^9}, {
   3.6555686496907816`*^9, 3.6555686753974147`*^9}, {3.6555687066133614`*^9, 
   3.655568816418331*^9}, {3.655568856699342*^9, 3.655569016104062*^9}, {
   3.655569658961447*^9, 3.655569718280781*^9}, {3.6561034177334533`*^9, 
   3.6561034714609547`*^9}, 3.656630360044797*^9, {3.6568492770684767`*^9, 
   3.656849542611176*^9}, {3.656849987692069*^9, 3.656850021541729*^9}, {
   3.6568564490765667`*^9, 3.6568565247927303`*^9}, {3.6568565815805798`*^9, 
   3.656856605376685*^9}, {3.6568569201714997`*^9, 3.656856968523478*^9}, 
   3.65713628306363*^9, {3.6571367338972425`*^9, 3.657136752822464*^9}, 
   3.6571368440059414`*^9, {3.657136928160592*^9, 3.657136948186384*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\<\"vorts1\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.8580383299980582`", ",", "0.08554667261461592`", ",", 
      "0.056414997387325944`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "6109.532265129797`", ",", "609.122154851374`", ",", 
      "401.69446366791226`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.657136956838317*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts2\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.8570619744782325`", ",", "0.08654516211769435`", ",", 
      "0.05639286340407316`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "6096.461481415536`", ",", "615.6138797017495`", ",", 
      "401.1342584402471`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.65713696230214*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts3\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.8524923602069715`", ",", "0.09328296558911264`", ",", 
      "0.054224674203915905`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "6151.790244146978`", ",", "673.1523523763639`", ",", 
      "391.2983122555029`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.657136967526205*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts4\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.8400783560723589`", ",", "0.10796139159381818`", ",", 
      "0.05196025233382292`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "6289.483056652971`", ",", "808.2833443973522`", ",", 
      "389.0150535491758`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.657136972645738*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts5\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.823678435851551`", ",", "0.12595774122996736`", ",", 
      "0.05036382291848165`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "6568.697813614352`", ",", "1004.4919272042284`", ",", 
      "401.6430673553706`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.657136977771392*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts6\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.8231382746509066`", ",", "0.12619114115188257`", ",", 
      "0.05067058419721092`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "6566.861652862834`", ",", "1006.7321509411553`", ",", 
      "404.24157950125687`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.657136982854273*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts7\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.8017964719528402`", ",", "0.14690249083193532`", ",", 
      "0.051301037215224346`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "6669.501791164534`", ",", "1221.9640020912336`", ",", 
      "426.732183994521`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.6571369878558035`*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts8\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.7767152687591887`", ",", "0.16955263512907998`", ",", 
      "0.053732096111731374`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "6526.649586507447`", ",", "1424.7314047582463`", ",", 
      "451.504659397313`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.6571369931125174`*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts9\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.7546427969559991`", ",", "0.18524636701484296`", ",", 
      "0.06011083602915784`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "6351.492666479262`", ",", "1559.1362513929942`", ",", 
      "505.9261623581025`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.657136998342942*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts10\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.7233436738259239`", ",", "0.204068860852805`", ",", 
      "0.07258746532127112`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "6152.228858454859`", ",", "1735.6595215800185`", ",", 
      "617.3755506142518`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.6571370035225725`*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts11\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.6605545155769968`", ",", "0.24025923562445525`", ",", 
      "0.09918624879854783`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "5803.102048262568`", ",", "2110.724897775309`", ",", 
      "871.3708104160871`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.657137008618122*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts12\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.606200277033891`", ",", "0.26576392357518064`", ",", 
      "0.12803579939092827`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "5545.874033675143`", ",", "2431.363525689742`", ",", 
      "1171.3462400534183`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.65713701373341*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts13\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.5536884777206532`", ",", "0.282273837168652`", ",", 
      "0.1640376851106948`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "5400.506741572926`", ",", "2753.2119990549354`", ",", 
      "1599.973017244674`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.6571370189273624`*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts14\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.5270956118478178`", ",", "0.27624072908505176`", ",", 
      "0.19666365906713043`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "5425.928708330139`", ",", "2843.6254612291855`", ",", 
      "2024.4581241660578`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.6571370243809376`*^9}],

Cell[BoxData[
 RowBox[{"\<\"vorts15\"\>", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "0.5249229827284948`", ",", "0.2650253668490509`", ",", 
      "0.2100516504224543`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
     "5690.717878667252`", ",", "2873.154049359499`", ",", 
      "2277.181075763434`"}], "}"}]}], "}"}]}]], "Print",
 CellChangeTimes->{3.656850084488097*^9, 3.6568566385568857`*^9, 
  3.6568569785696325`*^9, 3.656857442319784*^9, 3.6571367844596357`*^9, 
  3.657136914086496*^9, 3.657137029680549*^9}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1282, 797},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
FrontEndVersion->"10.3 for Microsoft Windows (64-bit) (October 9, 2015)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 2253, 60, 312, "Input"],
Cell[2814, 82, 333, 10, 52, "Input"],
Cell[3150, 94, 700, 18, 52, "Input"],
Cell[CellGroupData[{
Cell[3875, 116, 20086, 462, 1592, "Input"],
Cell[CellGroupData[{
Cell[23986, 582, 557, 14, 23, "Print"],
Cell[24546, 598, 555, 14, 23, "Print"],
Cell[25104, 614, 557, 14, 23, "Print"],
Cell[25664, 630, 556, 14, 23, "Print"],
Cell[26223, 646, 556, 14, 23, "Print"],
Cell[26782, 662, 558, 14, 23, "Print"],
Cell[27343, 678, 559, 14, 23, "Print"],
Cell[27905, 694, 559, 14, 23, "Print"],
Cell[28467, 710, 557, 14, 23, "Print"],
Cell[29027, 726, 558, 14, 23, "Print"],
Cell[29588, 742, 557, 14, 23, "Print"],
Cell[30148, 758, 556, 14, 23, "Print"],
Cell[30707, 774, 557, 14, 23, "Print"],
Cell[31267, 790, 561, 14, 23, "Print"],
Cell[31831, 806, 555, 14, 23, "Print"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
